# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python

from cerbero.tools.libtool import LibtoolLibrary
from cerbero.tools.pkgconfig import PkgConfigWritter

class Recipe(recipe.Recipe):

    name = 'x264'
    _x264_version = '130'
    version = '0.%s' % _x264_version
    remotes = {'origin': 'git://git.videolan.org/x264.git'}
    config_sh = './configure --enable-static --enable-shared'
    configure_tpl = '%(config-sh)s --prefix=%(prefix)s --libdir=%(libdir)s --host=%(host)s %(options)s'
    commit = 'origin/stable'
    files_bins = [
        "x264"
    ]
    files_libs = [
        'libx264'
    ]
    files_devel = [
        "include/x264.h",
        "include/x264_config.h",
        "lib/pkgconfig/x264.pc",
    ]
    files_misc = [
    ]
    
    force_configure = True # x264 ships with both Makefile and configure already there

    def configure(self):
        # x264 has it's own definition of various configure options
        self.config.host = self.config.build
        self.config.build = None
        super(recipe.Recipe, self).configure()
        

    def post_install(self):
        lib = LibtoolLibrary('libx264', self._x264_version, None, None, self.config.libdir, self.config.target_platform)
        lib.save()
        
        pc = PkgConfigWritter('x264', 'x264', self.version, '', '-L${libdir} -lx264', '-I${includedir}', self.config.prefix)
        pc.libs_priv = '${libdir}/libx264.a'
        pc.save('x264', os.path.join(self.config.prefix, 'lib', 'pkgconfig'))
